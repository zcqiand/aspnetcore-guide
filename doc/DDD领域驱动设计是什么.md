# 1 DDD是什么？
DDD是领域驱动设计，是Eric Evans于2003年提出的，离现在有17年。

# 2 为什么需要DDD
当软件越来越复杂，实际开发中，大量的业务逻辑堆积在一个巨型类中的例子屡见不鲜，代码的复用性和扩展性无法得到保证。为了解决这样的问题，DDD提出了清晰的分层架构和领域对象的概念，让面向对象的分析和设计进入了一个新的阶段，对企业级软件开发起到了巨大的推动作用。

## 2.1 POP，OOP，DDD是如何解决问题
**面向过程编程（POP）**，接触到需求第一步考虑把需求自顶向下分解成一个一个函数。并且在这个过程中考虑分层，模块化等具体的组织方式，从而分解软件的复杂度。当软件的复杂度不是很大，POP也能得到很好的效果。

**面向对象编程（OOP）**，接触到需求第一步考虑把需求分解成一个一个对象，然后每个对象添加一个一个方法和属性，程序通过各种对象之间的调用以及协作，从而实现计算机软件的功能。跟很多工程方法一样，OOP的初衷就是一种处理软件复杂度的设计方法。

**领域驱动设计（DDD）**，接触到需求第一步考虑把需求分解成一个一个问题域，然后再把每个问题域分解成一个一个对象，程序通过各种问题域之间的调用以及协作，从而实现计算机软件的功能。DDD是解决复杂中大型软件的一套行之有效方式，现已成为主流。

## 2.2 POP，OOP，DDD的特点
**POP**，无边界，软件复杂度小适用，例如“盖房子”。

**OOP**，以“对象”为边界，软件复杂度中适用，例如“盖小区”。

**DDD**，以“问题域”为边界，软件复杂度大适用，例如“盖城市”。

## 3 DDD的分层架构和构成要素
### 3.1 分层架构
![image](https://gitee.com/zcqiand/self-media/raw/master/assets/img/200914/994599-20180830125911190-468037055.png)

![image](https://gitee.com/zcqiand/self-media/raw/master/assets/img/200914/994599-20180830125945668-1072959527.png)

整个架构分为四层，其核心就是领域层（Domain），所有的业务逻辑应该在领域层实现，具体描述如下：

**用户界面/展现层**，负责向用户展现信息以及解释用户命令。

**应用层**，定义软件要完成的作业并指导富有表现力的领域对象解决问题。 这一层负责执行对业务具有意义的任务或与其他系统的应用层进行交互时需执行的任务。 这一层很“薄”。 它不包含业务规则或知识，仅针对下一层中领域对象之间的协作，协调任务和委派工作。 它不具有反映业务状况的状态，但它可以具有状态，用于反映用户或程序的任务的进度。

.NET 中微服务的应用层通常被编码为 ASP.NET Core Web API 项目。 该项目实现微服务的交互、远程网络访问和从 UI 或客户端应用中使用的外部 Web API。 它包括查询（如果使用 CQRS 方法）、微服务接受的命令，甚至是微服务之间的事件驱动的通信（集成事件）。 表示应用程序层的 ASP.NET Core Web API 不能包含业务规则或领域知识（尤其是用于事务或更新的域规则）；这些规则和知识应由域模型类库所有。 应用层须只能协调任务，不能保有或定义任何领域状态（领域模型）。 它将业务规则的执行委托给领域模型类自身（聚合根和领域实体），最终在这些领域实体内更新数据。

**领域层**，负责表示业务概念、有关业务状况的信息和业务规则。 反映业务状况的状态是通过这个层进行控制和利用的，但有关状态存储的具体技术细节则由基础结构负责实施。 这一层是业务软件的核心。

领域层是表述业务的地方。 在 .NET 中实现微服务领域层时，该层被编码为类库，具有用于捕获数据和行为（方法和逻辑）的领域实体。

领域层实体不应在任何数据访问基础结构框架（如 Entity Framework 或 NHibernate）上具有任何直接的依赖关系（如派生自基类）。 理想情况下，域实体不应派生自或实现任何在基础结构框架中定义的类型。

**基础设施层**，基础设施层是关于如何将最初存放在域实体中的数据（内存中）持久保存在数据库或另一个持久性存储区中。 一个例子是使用 Entity Framework Core 代码实现存储库模式类，该类使用 DBContext 将数据持久保存在关系数据库中。

### 3.2 构成要素
**实体（Entity）**，具备唯一ID，能够被持久化，具备业务逻辑，对应现实世界业务对象。

**值对象（Value Object）**，不具有唯一ID，由对象的属性描述，一般为内存中的临时对象，可以用来传递参数或对实体进行补充描述。

**领域服务（Domain Service）**，为上层建筑提供可操作的接口，负责对领域对象进行调度和封装，同时可以对外提供各种形式的服务。

**聚合根（Aggregate Root）**，聚合根属于实体对象，聚合根具有全局唯一ID，而实体只有在聚合内部有唯一的本地ID，值对象没有唯一ID

**工厂（Factories）**，主要用来创建聚合根，目前架构实践中一般采用IOC容器来实现工厂的功能。

**仓储（Repository）**，封装了基础设施来提供查询和持久化聚合操作。

# 4 小结

通过本文介绍，我们了解DDD是为解决软件复杂性而诞生，与OOP最大的区别就是划分边界的方式不一样，所以DDD本身掌握起来并不会感觉复杂，DDD其实是研究将包含业务逻辑的ifelse语句放在哪里的学问。